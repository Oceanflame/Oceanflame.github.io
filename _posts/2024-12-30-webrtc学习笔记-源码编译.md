---
title: "webrtc学习笔记-源码编译"
date: 2024-12-30 00:00:00 +0800
categories: [音视频, WebRTC]
tags: [WebRTC, 音视频]
---

# 前言

学习实时音视频通讯，离不开webrtc，第一步就是先下载源码并编译跑demo成功

# 下载源码

第一步就是需要找到源码的位置，官方的webrtc源码在这个链接

[https://webrtc.googlesource.com/src](https://webrtc.googlesource.com/src)

![webrtc](/assets/data/webrtc1.png)

但是这个不包含原生开发的代码。Android/iOS原生开发的下载方式链接如下

Android:[https://webrtc.googlesource.com/src/+/main/docs/native-code/android/](https://webrtc.googlesource.com/src/+/main/docs/native-code/android/)

iOS:[https://webrtc.googlesource.com/src/+/main/docs/native-code/ios/](https://webrtc.googlesource.com/src/+/main/docs/native-code/ios/)


## 1. 安装depot_tools

WebRTC使用Google的depot_tools工具集来管理代码和依赖，所以首先需要安装它，不然代码太多拉不下来，按照如下链接的指示即可：

[https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up](https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up)

```bash
git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
```

将depot_tools添加到PATH环境变量：

```bash
# 在.bashrc或.zshrc中添加
export PATH=$PATH:/path/to/depot_tools
```

## 2.获取WebRTC源码

按照链接的说明即可

![webrtc代码下载](/assets/data/webrtc源码下载.png)

# 编译WebRTC

## 1. 生成ninja构建文件

WebRTC使用GN和Ninja作为构建系统。首先需要生成构建文件：

### iOS平台

```bash
gn gen out/ios --args='target_os="ios" target_cpu="arm64" is_debug=false'
```

### Android平台

```bash
gn gen out/android --args='target_os="android" target_cpu="arm64" is_debug=false'
```

### 桌面平台

```bash
# macOS
gn gen out/mac --args='is_debug=false'

# Windows
gn gen out/win --args='is_debug=false'

# Linux
gn gen out/linux --args='is_debug=false'
```

## 2. 执行编译

```bash
ninja -C out/[平台]
```

例如编译iOS版本：

```bash
ninja -C out/ios
```

# 常见问题及解决方案

## 1. 网络连接问题

由于众所周知的原因，在国内下载WebRTC源码可能会遇到网络连接问题。可以考虑以下解决方案：

- 使用VPN或代理
- 配置git的代理：
  ```bash
  git config --global http.proxy http://127.0.0.1:1080
  git config --global https.proxy http://127.0.0.1:1080
  ```

## 2. 编译错误

可能遇到的常见编译错误：

- 缺少依赖：使用`gclient sync`确保所有依赖已下载
- 编译工具版本不匹配：确保使用推荐版本的编译工具
- 内存不足：增加swap空间或使用更高配置的机器

## 3. 编译参数定制

WebRTC的编译可以通过GN参数进行广泛的定制，一些常用参数：

- `is_debug=false`：生成发布版本
- `is_component_build=false`：静态链接
- `rtc_include_tests=false`：不包含测试代码
- `rtc_build_examples=false`：不构建示例

完整的参数列表可以通过`gn args --list out/[平台]`查看。

# 验证编译结果

编译完成后，可以通过运行WebRTC自带的示例程序来验证编译是否成功：

```bash
# 运行AppRTCMobile示例（iOS平台）
open out/ios/AppRTCMobile.app
```

# 参考资料

1. [WebRTC官方文档](https://webrtc.org/native-code/development/)
2. [Chromium开发者文档](https://www.chromium.org/developers/)
3. [WebRTC源码仓库](https://webrtc.googlesource.com/src) 