---
title: "APM - 卡顿监控及优化 - (二)卡顿监控"
date: 2024-04-09 00:00:00 +0800
categories: [APM, 卡顿监控及优化]
tags: [APM, 卡顿, 性能优化, iOS]
---
## 前言

&emsp;&emsp; 卡顿监控主要涉及以下几个内容：
1. 卡顿指标定义
2. 卡顿指标监控和获取
3. 各个指标获取方法原理

## 卡顿指标定义

### 分位帧率

分位：统计学概念，是将数据集分成相等的连续部分的值。分位值是数据集的临界值，它们将整个数据集分割成具有相同数量数据点的几个部分。

人话就是，100个数从大到小排列，90分位值就是第90个数。

分位统计有很多好处，比较突出的点就是**抗异常值**，便于获取全部数据后了解**数据分布**，同时便于设置阈值，用作性能指标。

依据上传的帧率集合做数据集，取相应分位用作指标计算，一点点递增优化

### 卡顿率

卡顿率 = 卡顿次数 / 启动次数

卡顿率的计算首先要定义好什么情况算一次卡顿，一次主线程阻塞算一次卡顿，但是阻塞多少秒算是卡顿呢？

这需要根据应用场景，实际体验，业务经验等来判断。就像一般人们认为延迟高于400ms，人们会感觉音视频通讯的延迟比较明显，所以定义，低于400ms延迟的才是符合标准的实时音视频通讯。体验上滑动列表页面0.5秒就能感受到卡顿，Matrix卡顿监控的默认值是2秒，也就是说阻塞两秒以上才算卡顿。或许2秒大家觉得很长，但是其实把卡顿标准定的过低也存在坏处，很容易导致收集上来的堆栈过多，难以聚类，从而不容易发现主要问题所在。

所以实际卡顿的标准，要视实际情况而定。

## 监控相关原理

以上两种指标是卡顿相关的常见指标，接下来介绍两种指标相关的监控原理和方案。

### 帧率监控原理

### 卡顿监控原理